---
title: "Deleting Data: A Detailed Guide"
output: 
  rmarkdown::html_vignette
editor_options:
  chunk_output_type: console
vignette: >
  %\VignetteIndexEntry{deleting-data}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
---

<style>
body, h1, h2, h3, h4 {
    font-family: "Roboto";
}
</style>

```{r setup, include = FALSE}
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
```

If you haven't already, please read the `installing-neon`, `getting-started` and `pulling-data` vignettes before proceeding. You can view them in a browser by typing `browseVignettes("neon")` or in RStudio with `vignette(<name_of_vignette>, package = "neon")`.

`delete_smartabase()` allows you to programatically delete Smartabase records using R.

Use this function at your own risk. Once records are deleted, they cannot be retrieved. It is advised that you practice how this function works using test data before running on real data.

`delete_smartabase()` is fairly straightforward. Besides the usual Smartabase credentials, it expects only one argument: event_id. These are the IDs of records that are returned by `pull_smartabase()`.

An example workflow might start with first pulling the to-be-deleted data with `pull_smartabase()`:

```{r delete_example1, eval = FALSE}
example_data <- pull_smartabase(
  form       = "Example profile form",
  start_date = "15/04/2019",
  end_date   = "31/04/2019"
)
```

```{r delete_example2, echo = FALSE}
example_data <- dplyr::tibble(
  about              = c("Charlie Thompson", "Jack Williams", "Jamie Anderson", "Liam Walker"),
  user_id            = c(31808, 31811, 37201, 37204),
  form               = c("Example event form", "Example event form", "Example event form", "Example event form"),
  start_date         = c("15/04/2019", "15/04/2019", "15/04/2019", "15/04/2019"),
  Distance           = c(5411, 2374, 1600, 2564),
  RPE                = c(7, 3, 6, 5),
  entered_by_user_id = c(37201, 37201, 37201, 37201),
  event_id           = c(16517, 36505, 36014, 28970)
)
```

```{r delete_example3}
print(example_data)
```

Let's say that we need to delete the record with `user_id = 31808`. It has `event_id = 16517`. We would pass that event ID to `delete_smartabase()` like so:

```{r delete_example4, eval = FALSE}
pull_smartabase(
  event_id = 16517
)
```

```{r delete_example5, echo = FALSE}
cat("Deleting events...") 
cat("|===================================================================| 100%")
message("Authentication success: (200) ok")
message('{"message": "Deleted 16517","state": "SUCCESS"}')
```

That event will now be deleted from Smartabase.

Once again, please use the function at your own risk and put appropriate measures in place to test and verify that it is doing as you expect before applying to real data.
